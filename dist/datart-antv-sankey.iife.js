(function(){"use strict";const e="@global@";function t({dHelper:t}){const a=[{source:"首次打开",target:"首页 UV",value:160},{source:"结果页",target:"首页 UV",value:40},{source:"验证页",target:"首页 UV",value:10},{source:"我的",target:"首页 UV",value:10},{source:"朋友",target:"首页 UV",value:8},{source:"其他来源",target:"首页 UV",value:27},{source:"首页 UV",target:"理财",value:30},{source:"首页 UV",target:"扫一扫",value:40},{source:"首页 UV",target:"服务",value:35},{source:"首页 UV",target:"蚂蚁森林",value:25},{source:"首页 UV",target:"跳失",value:10},{source:"首页 UV",target:"借呗",value:30},{source:"首页 UV",target:"花呗",value:40},{source:"首页 UV",target:"其他流向",value:45}];return{config:{datas:[{label:`${e}.sankey.source`,key:"source",type:"group",required:true,limit:[1,1]},{label:`${e}.sankey.target`,key:"target",type:"group",required:true,limit:[1,1]},{label:`${e}.sankey.metrics`,key:"metrics",type:"aggregate",required:true,limit:[1,1]}],styles:[{label:"geometry.title",key:"geometry",comType:"group",rows:[{label:"geometry.nodeWidthRatio",key:"nodeWidthRatio",default:.008,max:1,min:.001,comType:"inputNumber"},{label:"geometry.nodeWidthPadding",key:"nodeWidthPadding",default:.01,max:1,min:.01,comType:"inputNumber"},{label:"geometry.nodeAlign.title",key:"nodeAlign",comType:"select",default:"justify",options:{translateItemLabel:true,items:[{label:"@global@.geometry.nodeAlign.left",value:"left"},{label:"@global@.geometry.nodeAlign.right",value:"right"},{label:"@global@.geometry.nodeAlign.center",value:"center"},{label:"@global@.geometry.nodeAlign.justify",value:"justify"}]}}]},{label:"theme.title",key:"theme",comType:"group",rows:[{label:"theme.current",key:"current",comType:"select",default:"default",options:{translateItemLabel:false,items:[{label:"默认",value:"default"},{label:"黑暗主题",value:"dark"}]}}]}],i18ns:[{lang:"zh",translation:{sankey:{source:"来源",target:"目标",metrics:"指标"},theme:{title:"主题设置",current:"当前主题"},geometry:{title:"几何样式设置",nodeWidthRatio:"节点的宽度配置",nodeWidthPadding:"节点的之间垂直方向的间距",nodeAlign:{title:"对齐方式",left:"左对齐",right:"右对齐",center:"居中",justify:"两端对齐"}}}},{lang:"en",translation:{sankey:{source:"Source",target:"Target",metrics:"Metric"},theme:{title:"Theme Style",current:"Current"},geometry:{title:"Geometry Style",nodeWidthRatio:"Node Width Ratio",nodeWidthPadding:"Node Width Padding",nodeAlign:{title:"Align Type",left:"left",right:"right",center:"center",justify:"justify"}}}}]},isISOContainer:"antv-g2plot",dependency:["https://cdnjs.cloudflare.com/ajax/libs/g2plot/2.4.23/g2plot.min.js"],meta:{id:"experiment-antv-sankey",name:"[Experiment] AntV Sankey Chart",icon:"chart",requirements:[{group:0,aggregate:3}]},_chart:null,onMount(e,t){if(void 0===e.containerId||!t.document)return;const{Sankey:r}=t.window.G2Plot;if(!r)return;this._chart=new r(e.containerId,{data:a,sourceField:"source",targetField:"target",weightField:"value",nodeWidthRatio:.008,nodePaddingRatio:.03});this._chart.render()},onUpdated(e,t){if(!this._chart)return;const a=this.getOptions(e.dataset,e.config,e.drillOption,e.selectedItems);this._chart.update(a)},onUnMount(){if(!this._chart)return;this._chart.destroy()},onResize(e,t){if(!this._chart)return;if(!t.width||!t.height)return;this._chart.changeSize(t.width,t.height)},getOptions(e,a,r,o){const i=a.styles||[];const l=a.datas||[];const n=l.filter((e=>"metrics"===e.key)).flatMap((e=>e.rows||[])).map((e=>`${e.aggregate}(${e.colName})`)).findLast((e=>e));const s=l.filter((e=>"source"===e.key)).flatMap((e=>e.rows||[])).map((e=>e.colName||"source")).findLast((e=>e));const d=l.filter((e=>"target"===e.key)).flatMap((e=>e.rows||[])).map((e=>e.colName||"target")).findLast((e=>e));const u=t.transformToObjectArray(e.rows,e.columns);const[g,c,m]=t.getStyles(i,["geometry"],["nodeWidthRatio","nodeWidthPadding","nodeAlign"]);const[h]=t.getStyles(i,["theme"],["current"]);return{data:u,sourceField:s,targetField:d,weightField:n,nodeWidthRatio:g,nodePaddingRatio:c,nodeAlign:m,theme:h,nodeDraggable:true,rawFields:["path"],tooltip:{fields:["path","value"],formatter:({path:e,value:t})=>({name:e,value:t})}}}}}return t})();
